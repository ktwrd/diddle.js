<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>locale.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ConfigurationManager.html">ConfigurationManager</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfigurationManager.html#get">get</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="DiddleEngine.html">DiddleEngine</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="DiscordWrapper.html">DiscordWrapper</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="DiscordWrapper.html#_ready">_ready</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="EngineScript.html">EngineScript</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="EventManager.html">EventManager</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EventManager.html#call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EventManager.html#on">on</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="LocaleManager.html">LocaleManager</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LocaleManager.html#get">get</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LocaleManager.html#switch">switch</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Logger.html">Logger</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Logger.html#debug">debug</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Logger.html#error">error</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Logger.html#info">info</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Logger.html#warn">warn</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ScriptManager.html">ScriptManager</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ScriptManager.html#_fetchScripts">_fetchScripts</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ScriptManager.html#_parseEventScript">_parseEventScript</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">locale.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const path = require("path");
const fs = require("fs");
const toolbox = require("tinytoolbox");
const EngineScript = require("./enginescript");

const manifest = {
	version: '0.1b',
	name: 'diddle.js/locale'
}

function extend(target) {
	var sources = [].slice.call(arguments, 1);
	sources.forEach(function (source) {
		for (var prop in source) {
			target[prop] = source[prop];
		}
	});
	return target;
}

/**
 * @typedef LocaleManager.LocaleCode
 * @type {string}
 * @description Locale Codes must be formatted as &lt;code>[&lt;a href="https://en.wikipedia.org/wiki/ISO_639-1">ISO 639-1&lt;/a>]_[&lt;a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">ISO 3166-1 alpha-2&lt;/a>]&lt;/code>. So, for example the Default Locale Code is &lt;code>en_US&lt;/code>
 */

/**
 * @class LocaleManager
 * @description Used for managing localization files stored in &lt;code>engine/locale/&lt;/code>
 * @argument {DiddleEngine} diddle
 */
class LocaleManager extends EngineScript {
	
	cache = {
		/*
		&lt;locale>: {
			placeholders: {}, // Things that have %s which get replaced
			// all the other things would go here
		}
		*/
	};

	currentLocaleCode_default = "en_US";
	currentLocaleCode = this.currentLocaleCode_default;

	_fetch(_localeName) {
		var _localePath = path.join(this._localeDirectory,_localeName+".json");

		if (fs.existsSync(_localePath)) {
			// Locale Exists
			return JSON.parse(fs.readFileSync(_localePath));
		} else {
			// Locale does not exist
			throw new Error(`Locale does not exist at '${_localePath}'`);
		}
	}
	_reload() {
		toolbox.async.forEach(fs.readdirSync(this._localeDirectory),(_file) => {
			if (!_file.endsWith(".json")) return;
			this.cache[_file.replace(".json","")] = require("./locale/"+_file);
		});
	}
	_set(_targetLocale) {
		// Return the merged locale of target locale into default locale
		var newLocale = extend({},this.cache[this.currentLocaleCode],this.cache[this.currentLocaleCode_default]);
		this.currentLocaleCode = _targetLocale;
		this.currentLocale = newLocale;
		return newLocale;
	}

	/**
	 * @param {LocaleManager.LocaleCode} _localeName Locale Code to Switch to. If &lt;code>undefined&lt;/code> will switch to the Default Locale (&lt;code>en_US&lt;/code>)
	 */
	switch(_localeName) {
		if (_localeName == undefined) throw new Error("Locale is undefined");
		this.currentLocaleCode = _localeName;
		// Reload locale cache before setting the currentLocale to the one we desire.
		this._reload();
		if (this.cache[_localeName] == undefined) throw new Error("Locale does not exist");
		this.currentLocale = this.cache[_localeName];
		this.log.debug(`switched locale to; ${this.currentLocaleCode}`);
	}

	/**
	 * @param {LocaleManager.LocaleCode} _entry Locale Code to Get. If &lt;code>undefined&lt;/code> will return the Current Locale.
	 * @returns {LocaleData}
	 */
	get(_entry) {
		_entry = _entry || this.currentLocaleCode;
		return this.currentLocale[_entry];
	}
	constructor(diddle) {
		super(diddle,manifest);
		this._localeDirectory = path.join(__dirname,'locale');

		this.currentLocale = this.currentLocaleCode_default;
		this.log.info(`Running ${this.manifest.name}@${this.manifest.version}`);
	}
}
module.exports = LocaleManager;</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Mon Aug 02 2021 01:30:49 GMT+0800 (Australian Western Standard Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
